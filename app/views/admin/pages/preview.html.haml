- content_for :meta_title do
  = @page.meta_title
- content_for :meta_description do
  = @page.meta_description
- content_for :meta_keywords do
  = @page.meta_keywords
  
= # render :partial => "/shared/image_box", :locals => { :owner => @page } unless @page.images.empty?
- if @page.automatically_embed_videos_and_images?
  = ninja_parse(@cms_config['site_settings']['preview']) if @cms_config['site_settings']['preview']
- else
  = @cms_config['site_settings']['preview']

- if @page.permalink == "home" and !@settings.homepage_banner.blank?
  - content_for :banner do
    = @settings.homepage_banner
    
= render :partial => "pages/sidebar"


- content_for :head do
  - link = "'/admin/pages/preview?reload=false&page_id=' + getQueryVariable('page_id') + '&page_title=' + getQueryVariable('page_title') + '&menu_show_in_footer=' + getQueryVariable('menu_show_in_footer') + '&page_column_id=' + getQueryVariable('page_column_id') + '&page_show_site_search=' + getQueryVariable('page_show_site_search') +  '&page_show_side_column_text=' + getQueryVariable('page_show_side_column_text') + '&page_meta_description=' + getQueryVariable('page_meta_description')"
  - if @cms_config['features']['testimonials']
    - link += " + '&page_show_featured_testimonial=' + getQueryVariable('page_show_featured_testimonial')"
  - if @cms_config['modules']['newsletters']
    - link += " + '&page_show_newsletter_signup=' + getQueryVariable('page_show_newsletter_signup')"
  - link += " + '&page_show_articles=' + getQueryVariable('page_show_articles') + '&page_show_article_cats=' + getQueryVariable('page_show_article_cats')"
  - if @cms_config['modules']['events']
    - link += " + '&page_show_events=' + getQueryVariable('page_show_events')"
  :javascript
    function getQueryVariable(variable)
    {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++)
    {
    var pair = vars[i].split("=");
    if (pair[0] == variable)
    {
    return pair[1];
    }
    }
    } 
    window.onload = function() {
    if (getQueryVariable('reload') == "true")
    {
    window.location = #{link};
    }
    };