- content_for :head do
  %style{:type => "text/css"}
    ==.advanced-side-column-options { padding: 5px; border: 1px solid #ccc; background: #fff; color: #333; position: absolute; -moz-box-shadow: 0 4px 10px rgba(0,0,0,.6); -webkit-box-shadow: 0 4px 10px rgba(0,0,0,.6); box-shadow: 0 4px 10px rgba(0,0,0,.6); }
    ==#main-details { font-size: .85em; }
    ==#main-details label.title { font-weight: bold; }
    ==#page_title { font-size: 1.2em; }
  %script{:type => "text/javascript"}
    jQuery(document).ready(function() {
    jQuery("a#preview-link").fancybox({ 
    'zoomSpeedIn': 300,
    'zoomSpeedOut': 300,
    'overlayShow': true,
    'hideOnContentClick': false,
    'easingOut': 'easeOutQuad',
    'easingIn': 'easeInQuad',
    'type': 'iframe',
    'width': '90%',
    'height': '90%'
    }); 
    }); 
    function setLink(){
    document.getElementById('post_preview_body').value = tinyMCE.get('page_body').getContent();
    document.getElementById('submit-preview').click();
    - link = "document.getElementById('preview-link').href = '/admin/pages/preview?reload=true&page_id=#{@page.id}&page_title=' + escape(document.getElementById('page_title').value) + '&menu_show_in_footer=' + document.getElementById('menu_show_in_footer').checked + '&page_column_id=' + document.getElementById('page_column_id').value + '&page_show_site_search=' + document.getElementById('page_show_site_search').checked +  '&page_show_side_column_text=' + document.getElementById('page_show_side_column_text').checked + '&page_meta_description=' + escape(document.getElementById('page_meta_description').value)"
    - if @cms_config['features']['testimonials']
      - link += " + '&page_show_featured_testimonial=' + document.getElementById('page_show_featured_testimonial').checked"
    - if @cms_config['modules']['newsletters']
      - link += " + '&page_show_newsletter_signup=' + (document.getElementById('page_show_newsletter_signup').checked)"
    - link += " + '&page_show_articles=' + (document.getElementById('page_show_articles').value) + '&page_show_article_cats=' + (document.getElementById('page_show_article_cats').checked)"
    - if @cms_config['modules']['events']
      - link += " + '&page_show_events=' + (document.getElementById('page_show_events').checked)"
    = link
    }

= f.error_messages :message => "Please fix these things and try again:", :header_message => "We couldn't save your page"
- fields_for :menu do |m|
  - unless @no_edit
    #main-details.options
      
      #options
        %h3 Page Details
        =m.label :status_visible, "Show in menu", :class => "title"
        .radio-buttons
          = m.radio_button :status, "visible", :disabled => @no_edit
          %label{:for => "menu_status_visible"} Visible
          = m.radio_button :status, "hidden", :disabled => @no_edit
          %label{:for => "menu_status_hidden"} Hidden
        = m.label :parent_id, "Menu placement", :class => "title"
        %br
        %select{:name => "menu[parent_id]", :id => "menu_parent_id", :disabled => @no_edit, :style => "width: 250px;"}
          - for o in @options_for_parent_id
            - unless @page.menus.first.blank?
              %option{:value => o[1] , :selected => (@page.menus.first.parent_id and o[1] == @page.menus.first.parent_id ? "selected" : nil)}= o[0]
            - else
              %option{:value => o[1] , :selected => nil}= o[0]
        %br
        = f.check_box :automatically_embed_videos_and_images
        = f.label :automatically_embed_videos_and_images, "Automatically embed videos/images"
        %br
        = m.check_box :show_in_footer
        = m.label :show_in_footer, "Show in Footer Menu"
        %br
        %h3== #{icon('Gear')} Sidebar options
        = collection_select(:page, :column_id, @side_columns, :id, :title, {:include_blank => "Select a Side Column"}, :style => "width: 160px; margin: 0 0 0 0;")
        - content_for :head do
          :javascript
            jQuery(document).ready(function() {
            jQuery(".advanced-side-column-options").hide();
            jQuery(".display-advanced-side-column-options").click(function()
            {
            jQuery(this).next(".advanced-side-column-options").slideToggle();
            });
            });
        %div.display-advanced-side-column-options=link_to("Advanced Options", "javascript:null(0)")
        .advanced-side-column-options
          %img{:src =>"#{css_icon("Cancel","","16x16","red")}", :title =>"close", :alt=> "close box icon", :class => "close-icon", :onclick => "jQuery('.advanced-side-column-options').slideUp()"}
          = f.check_box :show_site_search
          = f.label :show_site_search
          %br
          = f.check_box :show_side_column_text
          = f.label :show_side_column_text
          - if @cms_config['features']['testimonials']
            %br
            = f.check_box :show_featured_testimonial
            = f.label :show_featured_testimonial, "Show random featured testimonial"
          - if @cms_config['modules']['newsletters']
            %br
            = f.check_box :show_newsletter_signup
            = f.label :show_newsletter_signup, "Show newsletter signup"
          - if @cms_config['modules']['blog']
            %br
            = f.check_box :show_articles
            = f.label :show_articles, "Show articles"
            %br 
            = collection_select(:page, :author_id, @authors, :id, :name, {:include_blank => "Filter by Author"}, :style => "width: 125px; margin: 0 0 0 20px;")
            %br
            = collection_select(:page, :article_category_id, @article_categories, :id, :name, {:include_blank => "Filter by Category"}, :style => "width: 125px; margin: 0 0 0 20px;")
            %br
            = f.check_box :show_article_cats
            = f.label :show_article_cats, "Show article categories"
          -if @cms_config['modules']['events']
            %br
            = f.check_box :show_events
            = f.label :show_events, "Show events"

  %h2.form-label= f.label :title, "Menu Title"
  .note
    %span.required *Required
    Short title displayed in site menu.
  = f.text_field :title, :class => "big", :size => 80, :style => "width: 550px;"
  %h2.form-label= f.label :meta_title, "Page Title"
  .note
    %span.required *Required
    Long title displayed as browser title and used to generate the page permalink.
  = f.text_field :meta_title, :class => "big", :size => 80, :disabled => @no_edit, :style => "width: 550px;"
  %h2.form-label= f.label :meta_description, "Short Description"
  .note Used in the Feature Box and as the Meta Description.
  = f.text_area :meta_description, :style => "width: 550px; height: 50px;"
  

  = clear
  .options
    - unless @page.images.empty?
      = render :partial => "admin/shared/image_options", :locals => {:images => @page.images}
    - unless @page.testimonials.empty?
      = render :partial => "admin/testimonials/testimonial_options", :locals => {:testimonials => @page.testimonials}

  %div{:style => "width: 560px;"}
    %div{:style => "position: absolute; margin: 17px 0 0 552px;"}
      = render :partial => 'admin/shared/help_tip', :locals =>{:tip_headline => "", :tip_text => "The Preview Button has been added to enable a very quick and simple way to preview what the content of the page will look like once published publicly. Clicking the preview button will pop up a box with the content formatted correctly, including images and videos."}
    %h2.form-label
      = f.label :body
      =link_to("#{icon("Search")} Preview Page", "", :id => "preview-link", :class => "preview-link", :onclick => "setLink()")

  #preview-div
  = f.text_area :body, :size => "100x40", :class => "mceEditor"
  %div
  - fancy_submit admin_pages_path do
    = submit_tag "Save page"
- content_for :pre_footer do
  %div{:style => "width: 1px; height: 1px; overflow: hidden;"}
    - form_remote_tag :url => post_preview_admin_pages_path, :method => "put", :html => {:name => "post_preview"} do
      = text_area :post_preview, :body
      = submit_tag "submit", :id => "submit-preview"