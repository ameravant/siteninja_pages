- content_for :head do
  %style{:type => "text/css"}
    ==.advanced-side-column-options { padding: 5px; border: 1px solid #ccc; background: #fff; color: #333; position: absolute; -moz-box-shadow: 0 4px 10px rgba(0,0,0,.6); -webkit-box-shadow: 0 4px 10px rgba(0,0,0,.6); box-shadow: 0 4px 10px rgba(0,0,0,.6); }
    ==#main-details, #body-details { font-size: .85em; }
    ==#main-details label.title { font-weight: bold; }
    ==#main-details .icon { width: 12px; height: 12px; vertical-align: baseline; margin-bottom: -2px; }
    ==#page_title { font-size: 1.2em; }
    ==.inline-window { text-align: left; }
    ==.inserts { padding: 5px 0; }
    ==#permissions-box { text-align: left; }
    ==#permissions-box ul { margin: 0; padding: 0; list-style: none; }
    ==#permissions-groups { padding: 4px 10px; border: 1px solid #ccc; background: #eee; margin: 5px; font-size: .8em; }
    ==#permissions-groups ul { padding-left: 10px; }
    ==#permissions-link { font-weight: bold; }
  %script{:type => "text/javascript"}
    jQuery(document).ready(function() {
    jQuery("a#preview-link").fancybox({ 
    'zoomSpeedIn': 300,
    'zoomSpeedOut': 300,
    'overlayShow': true,
    'hideOnContentClick': false,
    'easingOut': 'easeOutQuad',
    'easingIn': 'easeInQuad',
    'type': 'iframe',
    'width': '90%',
    'height': '90%'
    }); 
    });
    function addtext(text) {
    tinyMCE.execInstanceCommand("page_body","mceInsertContent",false,text);
    }
    function setLink(){
    document.getElementById('post_preview_body').value = tinyMCE.get('page_body').getContent();
    document.getElementById('submit-preview').click();
    - link = "document.getElementById('preview-link').href = '/admin/pages/preview?reload=true&page_id=#{@page.id}&page_title=' + escape(document.getElementById('page_title').value) + '&menu_show_in_footer=' + document.getElementById('menu_show_in_footer').checked + '&page_column_id=' + document.getElementById('page_column_id').value + '&page_show_site_search=' + document.getElementById('page_show_site_search').checked +  '&page_show_side_column_text=' + document.getElementById('page_show_side_column_text').checked + '&page_meta_description=' + escape(document.getElementById('page_meta_description').value) + '&page_head_script=' + escape(document.getElementById('page_head_script').value) + '&page_additional_styles=' + escape(document.getElementById('page_additional_styles').value)" 
    - if @cms_config['features']['testimonials']
      - link += " + '&page_show_featured_testimonial=' + document.getElementById('page_show_featured_testimonial').checked"
    - if @cms_config['modules']['newsletters']
      - link += " + '&page_show_newsletter_signup=' + (document.getElementById('page_show_newsletter_signup').checked)"
    - link += " + '&page_show_articles=' + (document.getElementById('page_show_articles').value) + '&page_show_article_cats=' + (document.getElementById('page_show_article_cats').checked)"
    - if @cms_config['modules']['events']
      - link += " + '&page_show_events=' + (document.getElementById('page_show_events').checked)"
    = link
    }

= f.error_messages :message => "Please fix these things and try again:", :header_message => "We couldn't save your page"
- fields_for :menu do |m|
  #main-details.options
    
    #options
      %h3 Page Details
      =m.label :status_visible, "Show in Menu", :class => "title"
      .radio-buttons
        = m.radio_button :status, "visible", :disabled => @no_edit
        %label{:for => "menu_status_visible"} Visible
        = m.radio_button :status, "hidden", :disabled => @no_edit
        %label{:for => "menu_status_hidden"} Hidden
      = m.label :parent_id, "Menu placement", :class => "title"
      %br
      %select{:name => "menu[parent_id]", :id => "menu_parent_id", :disabled => @no_edit, :class => "select"}
        - for o in @options_for_parent_id
          - unless @page.menus.first.blank?
            %option{:value => o[1] , :selected => (@page.menus.first.parent_id and o[1] == @page.menus.first.parent_id ? "selected" : nil)}= o[0]
          - else
            %option{:value => o[1] , :selected => nil}= o[0]
      %br
      = m.check_box :show_in_footer
      = m.label :show_in_footer, "Show in Footer Menu"
      - unless @templates.empty?
        %br
        = icon "Write", admin_templates_path, "Manage Templates", "#{icons_loc}/", "16x16", "gray", "Manage Templates"
        = f.label :template_id, "Template", :class => "title"
        %br
        = collection_select(:page, :template_id, @templates, :id, :title, {:include_blank => "Select a Template"}, :class => "select", :selected => (@page.template_id.blank? ? "" : @page.template_id))
      %br
      = icon "Write", admin_columns_path(:column_location => "main_column"), "Manage Main Columns", "#{icons_loc}/", "16x16", "gray", "Manage Main Columns"
      = f.label :main_column_id, "Main Column", :class => "title"
      %br
      = collection_select(:page, :main_column_id, @main_columns, :id, :title, {:include_blank => "Select a Main Column"}, :class => "select")
      %br
      = icon "Write", admin_columns_path(:column_location => "side_column"), "Manage Side Columns", "#{icons_loc}/", "16x16", "gray", "Manage Side Columns"
      = f.label :column_id, "Side Column", :class => "title"
      %br
      = collection_select(:page, :column_id, @side_columns, :id, :title, {:include_blank => "Select a Side Column"}, :class => "select")
      - content_for :head do
        :javascript
          jQuery(document).ready(function() {
          jQuery(".advanced-side-column-options").hide();
          jQuery(".display-advanced-side-column-options").click(function()
          {
          jQuery(this).next(".advanced-side-column-options").slideToggle();
          });
          });
      %div.display-advanced-side-column-options=link_to("Advanced Side Column Options", "javascript:null(0)")
      .advanced-side-column-options
        %img{:src =>"#{css_icon("Cancel","","16x16","red")}", :title =>"close", :alt=> "close box icon", :class => "close-icon", :onclick => "jQuery('.advanced-side-column-options').slideUp()"}
        = f.check_box :show_site_search
        = f.label :show_site_search
        %br
        = f.check_box :show_side_column_text
        = f.label :show_side_column_text
        - if @cms_config['features']['testimonials']
          %br
          = f.check_box :show_featured_testimonial
          = f.label :show_featured_testimonial, "Show random featured testimonial"
        - if @cms_config['modules']['newsletters']
          %br
          = f.check_box :show_newsletter_signup
          = f.label :show_newsletter_signup, "Show newsletter signup"
        - if @cms_config['modules']['blog']
          %br
          = f.check_box :show_articles
          = f.label :show_articles, "Show articles"
          %br 
          = collection_select(:page, :author_id, @authors, :id, :name, {:include_blank => "Filter by Author"}, :style => "width: 125px; margin: 0 0 0 20px;")
          %br
          = collection_select(:page, :article_category_id, @article_categories, :id, :name, {:include_blank => "Filter by Category"}, :style => "width: 125px; margin: 0 0 0 20px;")
          %br
          = f.check_box :show_article_cats
          = f.label :show_article_cats, "Show article categories"
        -if @cms_config['modules']['events']
          %br
          = f.check_box :show_events
          = f.label :show_events, "Show events"
    = link_to("#{icon("Lock")} Permissions", "#permissions-box", :class => "fancy-inline", :id => "permissions-link")

  %h2.title.form-label= f.label :title, "Menu Title"
  .note
    %span.required *Required
    Short title displayed in site menu.
  = f.text_field :title, :class => "big", :size => 80, :style => "width: 550px;"
  %h2.form-label= f.label :meta_title, "Page Title"
  .note
    %span.required *Required
    Long title displayed as browser title and used to generate the page permalink.
  = f.text_field :meta_title, :class => "big", :size => 80, :disabled => @no_edit, :style => "width: 550px;"
  %h2.form-label= f.label :meta_description, "Short Description"
  .note Used in the Feature Box and as the Meta Description.
  = f.text_area :meta_description, :style => "width: 550px; height: 80px;"
  
  .clear
  #body-wrapper
    .options#body-details
      = link_to("#{icon("Search")} Preview Page", "", :id => "preview-link", :class => "icon preview-link", :onclick => "setLink()")      
      = render :partial => 'admin/shared/help_tip', :locals =>{:tip_headline => "", :tip_text => "The Preview Button has been added to enable a very quick and simple way to preview what the content of the page will look like once published publicly. Clicking the preview button will pop up a box with the content formatted correctly, including images and videos."}
      .inserts
        %strong Insert:
        %br
        = render :partial => "admin/shared/parser_help"
      
        - unless @page.title.blank?
          = link_to("#{icon('Picture')} Attached Image", admin_page_images_path(@page, :fancy => "true"), :class => "fancy-iframe")
        = render :partial => "admin/shared/asset_options"
        = render :partial => "admin/shared/insert_link"
        = render :partial => "admin/shared/insert_map"
        - unless @page.testimonials.empty?
          = render :partial => "admin/testimonials/testimonial_options", :locals => {:testimonials => @page.testimonials}
        = f.check_box :automatically_embed_videos_and_images
        = f.label :automatically_embed_videos_and_images, "Use <strong>Ninja Code</strong> to embed objects."
        
      = link_to("#{icon('Css')} Additional Styles", "#additional-styles", :class => "fancy-inline")
      %br
      = link_to("#{icon('Code')} Head Script", "#head-script", :class => "fancy-inline")
      %div{ :style => "display: none;" }
        #additional-styles.inline-window
          %h2= f.label :additional_styles
          .note Add any CSS styles here that only pertain to this page.
          = f.text_area :additional_styles
          %div
            %input{:type => "button", :onclick => "jQuery.fancybox.close()", :value => "Done"}
        #head-script.inline-window
          %h2= f.label :head_script
          .note Add extra HTML to the head tag of the page.
          = f.text_area :head_script
          %div
            %input{:type => "button", :onclick => "jQuery.fancybox.close()", :value => "Done"}
        -if @cms_config['modules']['members']
          #permissions-box
            %h2 Permissions
            .note Who can access this page?
            %ul
              %li
                =f.radio_button :permission_level, "everyone"
                =f.label :permission_level_everyone, "Everyone"
              %li
                =f.radio_button :permission_level, "administrators"
                =f.label :permission_level_administrators, "Administrators Only"
              %li
                =f.radio_button :permission_level, "those checked"
                =f.label :permission_level_those_checked, "All those checked below"
              %li
                =f.radio_button :permission_level, "except those checked"
                =f.label :permission_level_except_those_checked, "Except for those checked below"
            #permissions-groups
              Select Groups
              %ul
                -for group in PersonGroup.role
                  %li
                    -if @page.permission_level == "except those checked"
                      = check_box_tag "page[person_group_ids][]", group.id, !@page.person_groups.include?(group), :id => "group_checkbox_#{group.id}"
                    -else 
                      = check_box_tag "page[person_group_ids][]", group.id, @page.person_groups.include?(group), :id => "group_checkbox_#{group.id}"
                    = label_tag "group_checkbox_#{group.id}", group.title
            %div
              %input{:type => "button", :onclick => "jQuery.fancybox.close()", :value => "Done"}
    %div{:style => "width: 560px;"}
      %h2.form-label
        = f.label :body

    = f.text_area :body, :size => "100x40", :class => "mceEditor"
  %div
  - fancy_submit admin_pages_path do
    = submit_tag "Save page"
- content_for :pre_footer do
  %div{:style => "width: 1px; height: 1px; overflow: hidden;"}
    - form_remote_tag :url => post_preview_admin_pages_path, :method => "put", :html => {:name => "post_preview"} do
      = text_area :post_preview, :body
      = submit_tag "submit", :id => "submit-preview"
%script{:type => "text/javascript"}
  jQuery(document).ready(function() {
  jQuery(".fancy-iframe").fancybox({ 
  'zoomSpeedIn': 300,
  'zoomSpeedOut': 300,
  'overlayShow': true,
  'hideOnContentClick': 'true',
  'easingOut': 'easeOutQuad',
  'easingIn': 'easeInQuad',
  'type': 'iframe',
  'width': 910,
  'autoScale': true,
  'height':"90%"
  }); 
  }); 
  jQuery(document).ready(function() {
  jQuery(".fancy-inline").fancybox({ 
  'zoomSpeedIn': 300,
  'zoomSpeedOut': 300,
  'overlayShow': true,
  'hideOnContentClick': false,
  'hideOnOverlayClick': false,
  'type': 'inline',
  'showCloseButton' : false,
  'autoScale': true
  }); 
  }); 